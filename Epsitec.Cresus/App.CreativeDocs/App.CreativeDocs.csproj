<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <ApplicationIcon>App.ico</ApplicationIcon>
    <OutputType>WinExe</OutputType>
    <RootNamespace>Epsitec.App.CreativeDocs</RootNamespace>
    <TargetFramework>net472</TargetFramework>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>
  <PropertyGroup>
    <ApplicationManifest>app.manifest</ApplicationManifest>
  </PropertyGroup>
  <ItemGroup>
    <ProjectReference Include="..\Common.Document.ExportEngine\Common.Document.ExportEngine.csproj" />
    <ProjectReference Include="..\Common.Document\Common.Document.csproj" />
    <ProjectReference Include="..\Common\Common.csproj" />
    <ProjectReference Include="..\Common.DocumentEditor\Common.DocumentEditor.csproj" />
  </ItemGroup>
  <ItemGroup>
    <None Include="App.ico" />
    <None Include="app.manifest">
      <SubType>Designer</SubType>
    </None>
    <None Include="uac.manifest">
      <SubType>Designer</SubType>
    </None>

    <EmbeddedResource Include="SplashScreen.png" />
    
    <Content Include="Creative Docs.exe.config">
      <SubType>Designer</SubType>
    </Content>
    <Content Include="..\External\agg-2.4.x\AntiGrain.Win32.dll">
      <Link>AntiGrain.Win32.dll</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="..\External\Clipboard.Win32.dll">
      <Link>Clipboard.Win32.dll</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="Original Samples\*" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="..\Solution Items\AssemblyInfo.CrDocVer.cs" Link="Properties\AssemblyInfo.CrDocVer.cs" />
  </ItemGroup>

  <Target Name="UpdateSignedDll" AfterTargets="Build">
    <PropertyGroup>
      <SignedDllDir>$([System.IO.Path]::GetFullPath('$(ProjectDir)..\Setup.CreativeDocs\SignedDlls'))\</SignedDllDir>
    </PropertyGroup>
    <ItemGroup>
      <SignedDllClean Include="$(SignedDllDir)*.*" />
      <SignedDllCopy Include="$(TargetDir)Common.*.exe;$(TargetDir)*.dll" Exclude="$(TargetDir)System.*" />
    </ItemGroup>
    <!--<Message Importance="high" Text="ProjectDir   = $(ProjectDir)" />
    <Message Importance="high" Text="TargetDir    = $(TargetDir)" />
    <Message Importance="high" Text="TargetPath   = $(TargetPath)" />
    <Message Importance="high" Text="SignedDllDir = $(SignedDllDir)" />-->
    <Delete Files="@(SignedDllClean)" />
    <Copy SourceFiles="@(SignedDllCopy)" DestinationFolder="$(SignedDllDir)" />
    <Copy SourceFiles="$(TargetPath)" DestinationFiles="$(SignedDllDir)Creative Docs.exe" />
  </Target>
</Project>